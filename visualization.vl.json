{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "hconcat": [
    {
      "vconcat": [
        {
          "hconcat": [
            {
              "description": "Top 20 countries by total F1 wins",
              "title": {
                "text": "Top 20 Leading Nationalities in F1 Wins",
                "anchor": "middle",
                "fontSize": 16
              },
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/wins_by_country.csv",
                "format": {"type": "csv"}
              },
              "transform": [
                {
                  "window": [{"op": "rank", "as": "r"}],
                  "sort": [{"field": "wins", "order": "descending"}]
                },
                {"filter": "datum.r <= 20"}
              ],
              "mark": {"type": "bar", "tooltip": true},
              "encoding": {
                "x": {
                  "field": "wins",
                  "type": "quantitative",
                  "title": "Wins",
                  "axis": {"grid": true}
                },
                "y": {
                  "field": "country",
                  "type": "nominal",
                  "title": "Country",
                  "sort": "-x"
                },
                "color": {"value": "#23b06a"}
              },
              "width": 200,
              "height": 350,
              "config": {"view": {"stroke": null}, "axis": {"grid": false}}
            },
            {
              "description": "Top‑20 non‑Finished statuses in F1 results",
              "title": {
                "text": "Top 20 Non-Finish Statuses",
                "anchor": "middle",
                "fontSize": 16
              },
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Formula1_data/results.csv",
                "format": {"type": "csv"}
              },
              "transform": [
                {
                  "lookup": "statusId",
                  "from": {
                    "data": {
                      "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Formula1_data/status.csv",
                      "format": {"type": "csv"}
                    },
                    "key": "statusId",
                    "fields": ["status"]
                  }
                },
                {"filter": "datum.status != 'Finished'"},
                {
                  "aggregate": [
                    {"op": "count", "field": "statusId", "as": "numTimes"}
                  ],
                  "groupby": ["status"]
                },
                {
                  "window": [{"op": "rank", "as": "r"}],
                  "sort": [{"field": "numTimes", "order": "descending"}]
                },
                {"filter": "datum.r <= 20"}
              ],
              "mark": {"type": "bar", "tooltip": true},
              "encoding": {
                "x": {
                  "field": "numTimes",
                  "type": "quantitative",
                  "title": "Count",
                  "axis": {"grid": true}
                },
                "y": {
                  "field": "status",
                  "type": "nominal",
                  "title": "Finish status",
                  "sort": "-x"
                },
                "color": {"value": "#fc0004"}
              },
              "width": 290,
              "height": 350,
              "config": {"view": {"stroke": null}, "axis": {"grid": false}}
            },
            {
              "width": 340,
              "height": 350,
              "title": {
                "text": "Constructor Points by Season (2010–2017)",
                "subtitle": "Total championship points per team per year",
                "anchor": "middle",
                "fontSize": 16,
                "subtitleFontSize": 13,
                "subtitleColor": "#0843f1"
              },
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/constructor_points_by_year.csv"
              },
              "transform": [
                {"filter": "datum.year >= 2010 && datum.year <= 2017"}
              ],
              "mark": "rect",
              "encoding": {
                "x": {
                  "field": "year",
                  "type": "ordinal",
                  "title": "Year",
                  "axis": {"labelAngle": 0}
                },
                "y": {
                  "field": "name",
                  "type": "ordinal",
                  "title": "Constructor"
                },
                "color": {
                  "field": "points",
                  "type": "quantitative",
                  "title": "Points",
                  "scale": {"scheme": "blues"}
                },
                "tooltip": [
                  {"field": "name", "type": "nominal", "title": "Team"},
                  {"field": "year", "type": "ordinal", "title": "Year"},
                  {
                    "field": "points",
                    "type": "quantitative",
                    "title": "Points",
                    "format": ".1f"
                  }
                ]
              }
            }
          ]
        },
        {
          "hconcat": [
            {
              "description": "F1 win rate bar chart",
              "width": 450,
              "height": 350,
              "title": {
                "text": "Win Rate by Starting Position",
                "subtitle": "Numbers above bars indicate total wins from each starting position",
                "anchor": "middle",
                "fontSize": 16,
                "subtitleFontSize": 12,
                "subtitleColor": "green"
              },
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/histogram_summary.json"
              },
              "layer": [
                {
                  "mark": {"type": "bar", "size": 16},
                  "encoding": {
                    "x": {
                      "field": "start_position",
                      "type": "quantitative",
                      "title": "Starting Position",
                      "axis": {"grid": false}
                    },
                    "y": {
                      "field": "win_rate",
                      "type": "quantitative",
                      "title": "Win Rate (%)"
                    },
                    "color": {
                      "field": "top_constructor",
                      "type": "nominal",
                      "title": "Top Winning Team",
                      "scale": {
                        "range": [
                          "#8eeb02",
                          "#fc0004",
                          "#0017eb",
                          "#23b06a",
                          "#fc7200",
                          "#dbc902"
                        ]
                      },
                      "legend": {
                        "orient": "right",
                        "direction": "vertical",
                        "offset": -781,
                        "titleFontSize": 11,
                        "labelFontSize": 10,
                        "padding": 10,
                        "titlePadding": 4,
                        "fillColor": "white",
                        "strokeColor": "#ccc",
                        "cornerRadius": 4
                      }
                    },
                    "tooltip": [
                      {
                        "field": "win_rate",
                        "title": "Win Rate (%)",
                        "format": ".2f"
                      },
                      {"field": "wins", "title": "Wins"},
                      {"field": "top_constructor", "title": "Top Team"}
                    ]
                  }
                },
                {
                  "mark": {
                    "type": "text",
                    "dy": -5,
                    "color": "black",
                    "fontSize": 10
                  },
                  "encoding": {
                    "x": {"field": "start_position", "type": "quantitative"},
                    "y": {"field": "win_rate", "type": "quantitative"},
                    "text": {"field": "wins", "type": "quantitative"}
                  }
                }
              ]
            },
            {
              "width": 300,
              "height": 350,
              "data": {
                "values": [
                  {
                    "x": 0,
                    "y": 0,
                    "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/main/images/image.png"
                  }
                ]
              },
              "mark": {"type": "image", "width": 640, "height": 360},
              "encoding": {
                "x": {"field": "x", "type": "quantitative", "axis": null},
                "y": {"field": "y", "type": "quantitative", "axis": null},
                "url": {"field": "url", "type": "nominal"}
              }
            }
          ]
        },
        {
          "hconcat": [
            {
              "title": {
                "text": "Avg Lap Time vs Season Points per Driver",
                "subtitle": "Each point represents a driver's average pace and total points in one season",
                "anchor": "middle",
                "fontSize": 16,
                "subtitleFontSize": 13,
                "subtitleColor": "green"
              },
              "description": "Scatterplot: average lap time per season vs total championship points per driver",
              "width": 450,
              "height": 350,
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/avgLapTime_vs_seasonPoints.csv",
                "format": {"type": "csv"}
              },
              "transform": [
                {
                  "calculate": "datum.year == 2017 ? '2017' : datum.year < 2003 ? 'Before 2003' : datum.year < 2010 ? '2003–2009' : '2010–2016'",
                  "as": "era"
                }
              ],
              "mark": {
                "type": "point",
                "filled": true,
                "size": 60,
                "opacity": 0.4
              },
              "encoding": {
                "x": {
                  "field": "avgLapTimeYear",
                  "type": "quantitative",
                  "title": "Average Lap Time (s)",
                  "scale": {"domain": [70, 130]}
                },
                "y": {
                  "field": "seasonPoints",
                  "type": "quantitative",
                  "title": "Points in Season"
                },
                "color": {
                  "field": "era",
                  "type": "nominal",
                  "title": "Season Era",
                  "scale": {
                    "domain": ["Before 2003", "2003–2009", "2010–2016", "2017"],
                    "range": ["red", "green", "blue", "black"]
                  },
                  "legend": {
                    "orient": "right",
                    "direction": "vertical",
                    "offset": -834,
                    "titleFontSize": 11,
                    "labelFontSize": 10,
                    "padding": 10,
                    "titlePadding": 4,
                    "fillColor": "white",
                    "strokeColor": "#ccc",
                    "cornerRadius": 4
                  }
                },
                "tooltip": [
                  {"field": "driver", "type": "nominal", "title": "Driver"},
                  {"field": "year", "type": "ordinal", "title": "Season"},
                  {
                    "field": "avgLapTimeYear",
                    "type": "quantitative",
                    "title": "Avg Lap Time (s)",
                    "format": ".2f"
                  },
                  {
                    "field": "seasonPoints",
                    "type": "quantitative",
                    "title": "Total Points"
                  },
                  {"field": "era", "type": "nominal", "title": "Era"}
                ]
              },
              "config": {"view": {"stroke": null}, "axis": {"grid": true}}
            },
            {
              "title": {
                "text": "Constructor Champions by Season (1958 – 2017)",
                "fontSize": 18,
                "fontWeight": "bold",
                "anchor": "middle",
                "dy": -17
              },
              "description": "Constructor champions by season (logo grid)",
              "data": {
                "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/champions_logos.csv",
                "format": {"type": "csv"}
              },
              "width": 670,
              "height": 400,
              "mark": {
                "type": "image",
                "width": 65,
                "height": 55,
                "crossOrigin": "anonymous"
              },
              "encoding": {
                "x": {
                  "field": "digit",
                  "type": "ordinal",
                  "title": "Year digit",
                  "axis": {"labelAngle": 0}
                },
                "y": {
                  "field": "decade",
                  "type": "ordinal",
                  "title": "Decade",
                  "sort": "ascending"
                },
                "url": {"field": "logo", "type": "nominal"},
                "tooltip": [
                  {"field": "year", "title": "Season"},
                  {"field": "name", "title": "Champion"}
                ]
              },
              "config": {"view": {"stroke": null}, "axis": {"grid": false}}
            }
          ]
        }
      ]
    },
    {
      "title": {
        "text": "Fastest Lap vs Winner’s Best Lap (2013 – 2017)",
        "anchor": "middle",
        "fontSize": 16,
        "dy": -5
      },
      "data": {
        "url": "https://raw.githubusercontent.com/an-mistral/Developing_a_Novel_InfoVis/refs/heads/main/Visualisations_data/gp_lap_compare_2010_2017.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "datum.year >= 2013"},
        {"fold": ["fastestLapSec", "winnerLapSec"], "as": ["type", "lapSec"]},
        {"filter": "datum.lapSec != null"}
      ],
      "width": 330,
      "height": 1280,
      "layer": [
        {
          "mark": {"type": "line", "strokeWidth": 2, "point": true},
          "encoding": {
            "x": {
              "field": "lapSec",
              "type": "quantitative",
              "title": "Lap time (sec)",
              "scale": {"reverse": true, "domainMin": 66},
              "axis": {"grid": true}
            },
            "y": {
              "field": "gp",
              "type": "ordinal",
              "sort": "ascending",
              "title": "Grand Prix"
            },
            "color": {
              "field": "type",
              "type": "nominal",
              "title": "",
              "scale": {
                "domain": ["fastestLapSec", "winnerLapSec"],
                "range": ["#c72525", "#1f77b4"]
              },
              "legend": {
                "orient": "none",
                "legendX": 1460,
                "legendY": 10,
                "direction": "horizontal",
                "labelExpr": "datum.value === 'fastestLapSec' ? 'Fastest lap' : 'Winner best lap'",
                "labelFontSize": 12,
                "symbolSize": 100,
                "padding": 5
              }
            },
            "tooltip": [
              {"field": "gp", "title": "Grand Prix"},
              {"field": "lapSec", "title": "Lap (sec)", "format": ".3f"}
            ]
          }
        },
        {
          "transform": [
            {
              "filter": "datum.year == 2017 || datum.gp === 'German Grand Prix, 2016'"
            }
          ],
          "mark": {"type": "rule", "strokeDash": [4, 5], "color": "green"},
          "encoding": {
            "y": {"field": "gp", "type": "ordinal", "sort": "ascending"},
            "x": {"value": 0},
            "x2": {"value": 330}
          }
        }
      ],
      "config": {"view": {"stroke": null}, "axis": {"grid": false}}
    }
  ]
}